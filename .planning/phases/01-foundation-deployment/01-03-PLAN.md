---
phase: 01-foundation-deployment
plan: 03
type: execute
wave: 3
depends_on: ["01-01", "01-02"]
files_modified:
  - scripts/install.sh
  - rachel8.service
  - README.md
autonomous: true

must_haves:
  truths:
    - "User can run one-liner curl | bash command to install Rachel8"
    - "Install script checks prerequisites (bun, git) and fails with clear messages"
    - "Install script clones repo to ~/rachel8 and launches setup wizard"
    - "systemd service keeps Rachel running with auto-restart on crash"
    - "systemd service has rate-limited restart to prevent infinite loops"
    - "README documents complete VPS setup from zero to running"
  artifacts:
    - path: "scripts/install.sh"
      provides: "curl | bash installer with prerequisite checks"
      contains: "command -v bun"
    - path: "rachel8.service"
      provides: "systemd unit file with auto-restart and rate limiting"
      contains: "Restart=always"
    - path: "README.md"
      provides: "Complete VPS setup instructions"
      contains: "curl"
  key_links:
    - from: "scripts/install.sh"
      to: "src/setup/wizard.ts"
      via: "launches wizard after clone and bun install"
      pattern: "bun run setup"
    - from: "rachel8.service"
      to: "src/index.ts"
      via: "ExecStart runs the entry point"
      pattern: "ExecStart.*bun.*index\\.ts"
    - from: "rachel8.service"
      to: ".env"
      via: "ConditionPathExists prevents crash loop without config"
      pattern: "ConditionPathExists"
---

<objective>
Create the curl | bash install script, the systemd unit file template, and the README with complete VPS setup instructions. After this plan, a user can go from a fresh VPS to a running Rachel8 by following the README.

Purpose: This is the deployment wrapper — the first thing a user touches and the last mile to production.
Output: Working install script, systemd service file, and comprehensive README.
</objective>

<execution_context>
@/Users/lory/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lory/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-deployment/01-RESEARCH.md
@.planning/phases/01-foundation-deployment/01-01-SUMMARY.md
@.planning/phases/01-foundation-deployment/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create install script and systemd service template</name>
  <files>
    scripts/install.sh
    rachel8.service
  </files>
  <action>
**scripts/install.sh:**
Create the curl | bash one-liner entry point. This is the first thing a user runs on their VPS.

Per research pitfall 3: wrap entire script body in main() function called at end to prevent partial download execution.

```
#!/usr/bin/env bash
set -euo pipefail
```

Structure:
```
main() {
  # 1. Prerequisites check
  # 2. Clone repo
  # 3. Install deps
  # 4. Launch wizard
}
main "$@"
```

**Step 1 — Prerequisite checks:**
- Check `bun` exists: `command -v bun >/dev/null 2>&1 || { error message with install instructions; exit 1; }`
  - Error: "Bun is required but not installed. Install it: curl -fsSL https://bun.sh/install | bash"
- Check `git` exists: similar pattern
  - Error: "git is required. Install it: sudo apt install git"
- Check `~/rachel8` doesn't already exist
  - Error: "~/rachel8 already exists. To reinstall: rm -rf ~/rachel8 && run this script again"

**Step 2 — Clone and setup:**
- Print "Cloning Rachel8..."
- `git clone https://github.com/OWNER/rachel8.git "$HOME/rachel8"` (use placeholder OWNER — open question from research)
- `cd "$HOME/rachel8"`
- Print "Installing dependencies..."
- `bun install`

**Step 3 — Launch wizard:**
- Print "Launching setup wizard..."
- `bun run setup` (runs src/setup/wizard.ts via package.json script)

Make the script executable (note this in verify).

**rachel8.service:**
Create the systemd unit file template (per research Pattern 4 and discretion recommendation):

```ini
[Unit]
Description=Rachel8 Personal AI Assistant
After=network.target
ConditionPathExists=%h/rachel8/.env

[Service]
Type=simple
User=%i
WorkingDirectory=%h/rachel8
ExecStart=%h/.bun/bin/bun run src/index.ts
Restart=always
RestartSec=5s
RestartSteps=5
RestartMaxDelaySec=60s

# Rate limiting: max 5 restarts in 300s window
StartLimitIntervalSec=300
StartLimitBurst=5

# Graceful shutdown
TimeoutStopSec=10
KillMode=mixed
KillSignal=SIGTERM

# Environment
Environment="NODE_ENV=production"

# Security hardening (minimal — Rachel needs home directory access)
NoNewPrivileges=true
PrivateTmp=true

# Logging: stdout/stderr to journalctl
StandardOutput=journal
StandardError=journal
SyslogIdentifier=rachel8

[Install]
WantedBy=multi-user.target
```

NOTE: The %h and %i specifiers may not work cleanly in all systemd versions. The install.ts from Plan 02 should replace these with actual paths when copying. Keep the template with actual hardcoded paths for the user running the install: use `/home/lory` for WorkingDirectory and ExecStart since this is a single-user project. The install.ts script will detect the actual username and home directory at install time and substitute.

Actually, use concrete values with the convention that install.ts substitutes them:
- WorkingDirectory=/home/lory/rachel8
- ExecStart=/home/lory/.bun/bin/bun run src/index.ts
- User=lory
- ConditionPathExists=/home/lory/rachel8/.env

Add a comment at the top: "# This file is a template. The setup wizard substitutes paths during installation."
  </action>
  <verify>
Run `bash -n scripts/install.sh` — syntax check passes (exit 0).
Verify scripts/install.sh is executable: `ls -la scripts/install.sh` shows execute bit.
Verify rachel8.service contains: Restart=always, RestartSec=5s, ConditionPathExists, StartLimitBurst.
  </verify>
  <done>
Install script checks bun/git prerequisites, clones repo, installs deps, launches wizard. Wrapped in main() for curl|bash safety. systemd service file has auto-restart with exponential backoff, rate limiting, ConditionPathExists guard, and security hardening.
  </done>
</task>

<task type="auto">
  <name>Task 2: Write README with complete VPS setup instructions</name>
  <files>
    README.md
  </files>
  <action>
Rewrite README.md with complete documentation for Phase 1. This satisfies requirement SETUP-06: "README contains clear VPS setup section: install gh, create shared folder, configure Syncthing, copy-paste one-liner."

Structure:

**# Rachel8**
Brief description: Personal AI assistant on Telegram, powered by Claude Opus 4.6. Runs 24/7 on your VPS.

**## Quick Start**
The one-liner install command:
```bash
curl -fsSL https://raw.githubusercontent.com/OWNER/rachel8/main/scripts/install.sh | bash
```
Brief note: "This clones the repo, installs dependencies, and launches the interactive setup wizard."

**## VPS Setup (from zero)**
Step-by-step for a fresh Hetzner VPS (or any Ubuntu/Debian server):

1. **Create VPS** — Hetzner cloud console, Ubuntu 22.04+, pick a plan
2. **SSH in** — `ssh root@your-vps-ip`, create a non-root user
3. **Install Bun:**
   ```bash
   curl -fsSL https://bun.sh/install | bash
   source ~/.bashrc
   ```
4. **Install git:**
   ```bash
   sudo apt update && sudo apt install -y git
   ```
5. **Create shared folder** (for Syncthing integration later):
   ```bash
   sudo mkdir -p /data/shared/vault
   sudo chown $USER:$USER /data/shared/vault
   ```
6. **Configure Syncthing** (optional — for syncing with local machine):
   - Brief instructions or link to Syncthing docs
   - Sync /data/shared/vault on VPS with ~/RachelShared/vault locally
7. **Install Rachel8:**
   ```bash
   curl -fsSL https://raw.githubusercontent.com/OWNER/rachel8/main/scripts/install.sh | bash
   ```
8. **Follow the setup wizard** — it will ask for API keys and configure everything

**## What You'll Need**
Before running the setup wizard, have these ready:

- **Claude API key** — Get from https://console.anthropic.com/settings/keys
  - Sign up for Anthropic account if needed, create an API key
- **Telegram bot token** — Create via @BotFather on Telegram:
  1. Open Telegram, search for @BotFather
  2. Send /newbot
  3. Choose a name (e.g., "Rachel")
  4. Choose a username (e.g., "rachel8_bot")
  5. Copy the token BotFather gives you
- **Exa API key** — Get from https://dashboard.exa.ai/api-keys
  - Sign up for Exa account, create an API key

**## Development**
For local development:
```bash
bun run dev          # Start with hot reload (bun --watch)
bun run start        # Start normally
bun run setup        # Re-run setup wizard
bun test             # Run tests
```

**## Service Management**
Rachel runs as a systemd service on the VPS:
```bash
sudo systemctl status rachel8    # Check status
sudo systemctl restart rachel8   # Restart
sudo systemctl stop rachel8      # Stop
sudo journalctl -u rachel8 -f    # Follow logs
sudo journalctl -u rachel8 -n 50 # Last 50 log lines
```

**## Project Structure**
Brief tree showing src/ layout with one-line descriptions.

**## License**
MIT (or whatever is appropriate — keep it simple)

Keep the README concise and practical. No marketing fluff. A developer should be able to go from zero to running Rachel in under 10 minutes by following these instructions.
  </action>
  <verify>
Read README.md — contains all sections: Quick Start with one-liner, VPS Setup steps, API key instructions, Development commands, Service Management commands, Project Structure.
Verify the one-liner curl command references scripts/install.sh.
Verify all three API key sources are documented with URLs.
Verify systemd management commands are included.
  </verify>
  <done>
README documents complete path from fresh VPS to running Rachel. Includes: one-liner install, step-by-step VPS setup, API key acquisition instructions for all three services, development commands, systemd service management, and project structure overview. A developer can follow this start-to-finish without external documentation.
  </done>
</task>

</tasks>

<verification>
1. `bash -n scripts/install.sh` — syntax valid
2. rachel8.service has Restart=always, RestartSec, ConditionPathExists, StartLimit settings
3. README has one-liner curl|bash command
4. README has step-by-step VPS setup from zero
5. README documents all three API key sources with links
6. README has development and service management commands
</verification>

<success_criteria>
- Install script passes bash syntax check
- Install script checks for bun and git before proceeding
- systemd service auto-restarts with exponential backoff and rate limiting
- systemd service won't start without .env (ConditionPathExists)
- README covers complete VPS setup from fresh server to running Rachel
- README includes instructions for obtaining all three API keys
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-deployment/01-03-SUMMARY.md`
</output>
